!function(t){var o={};function a(e){if(o[e]){return o[e].exports}var n=o[e]={"i":e,"l":!1,"exports":{}};return t[e].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=o,a.d=function(e,n,t){a.o(e,n)||Object.defineProperty(e,n,{"enumerable":!0,"get":t})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{"value":"Module"}),Object.defineProperty(e,"__esModule",{"value":!0})},a.t=function(n,e){if(1&e&&(n=a(n)),8&e){return n}if(4&e&&"object"==typeof n&&n&&n.__esModule){return n}var t=Object.create(null);if(a.r(t),Object.defineProperty(t,"default",{"enumerable":!0,"value":n}),2&e&&"string"!=typeof n){for(var o in n){a.d(t,o,function(e){return n[e]}.bind(null,o))}}return t},a.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(n,"a",n),n},a.o=function(e,n){return{}.hasOwnProperty.call(e,n)},a.p="",a(a.s=0)}([function(e,n,t){"use strict";var u=t(1),m={},g="https://authorize.aidalan.com/v1/",f=wx.getSystemInfoSync().system.toLowerCase().indexOf("ios")<0;m.getPubData=function(){var e,n,t,o,a,r,c=new Date,i=wx.getStorageSync("game_config"),s=i.game_id,l=i.game_name,d=(i.game_key,i.game_ver);return{"channel_platform":{"ad_id":"minigames"},"device":(r={},a=(r=wx.getSystemInfoSync()).system.split(" "),wx.getNetworkType({"success":function(e){wx.setStorageSync("networkType",e.networkType)}}),t=wx.getStorageSync("networkType"),wx.getScreenBrightness({"success":function(e){wx.setStorageSync("screen_brightness",e.value)}}),o=100*(wx.getStorageSync("screen_brightness")+0),{"screen_width":""+r.screenWidth,"screen_height":""+r.screenHeight,"device_name":r.brand+" "+r.model,"os_ver":""+a[1],"sdk_ver":"1.0.0","package_name":"com.junhai.union_new","os_type":""+a[0],"net_type":""+t,"brand":""+r.brand,"model":""+r.model,"battery_level":""+r.batteryLevel,"screen_brightness":""+o}),"game":{"game_name":l,"game_id":s,"game_ver":d},"other":{"client_ts":""+Math.round(c.getTime()/1e3),"client_time_zone":"GMT"+(e=c.getTimezoneOffset()/60,n=Math.abs(e)<10?"0"+Math.abs(e)+":00":Math.abs(e)+":00",e<0?"+ "+n:"- "+n)},"verify":{"open_id":"","open_key":"open_key","flag":5}}},m.createSign=function(e){var n=[];for(var t in e){n.push(t)}n.sort();for(var o="",a=0;a<n.length;a++){o+=n[a]+"="+JSON.stringify(e[n[a]])+"&"}return o.substring(0,o.length-1)},m.mnInit=function(e){wx.setStorageSync("game_config",e)},m.mnLogin=function(r){console.log("=====login=====");var c=g+"miniGame/otherOpenAuthorize";wx.login({"success":function(e){var n=m.getPubData();n.verify.open_id=e.code;var t=wx.getStorageSync("game_config").game_key,o=m.createSign(n)+t,a=u.md5(o);n.sign=a,wx.request({"url":c,"data":n,"method":"POST","header":{"content-type":"application/json"},"success":function(e){if(1==e.data.ret){console.log("\u767b\u5f55\u6210\u529f");var n={"ret":1,"data":e.data.content,"msg":"\u767b\u5f55\u6210\u529f"};wx.setStorageSync("open_id",e.data.content.open_id),r(n)}else{console.log("\u767b\u5f55\u5931\u8d25",e.data);var t={"ret":0,"data":e.data,"post_url":c,"msg":"\u767b\u5f55\u5931\u8d25"};r(t)}}})}})},m.onLoginRsp=function(e){var n={};n.access_token=e.access_token,n.union_user_id=e.union_user_id,wx.setStorageSync("login_rsp",n)},m.getBalance=function(t,o,a){var e=wx.getStorageSync("game_config").game_key,n=m.getPubData(),r=wx.getStorageSync("login_rsp").union_user_id;n.verify={"open_id":wx.getStorageSync("open_id"),"user_id":r,"type":1};var c=g+"miniGame/getMiniBalance",i=m.createSign(n)+e,s=u.md5(i);n.sign=s,wx.request({"url":c,"data":n,"method":"POST","header":{"content-type":"application/json"},"success":function(e){if(console.log(e),0===e.data.content.balance){console.log("\u4f59\u989d\u4e3a0\uff0c\u53ef\u4ee5\u4e0b\u5355",e.data),m.sendOrder(t,o,a)}else{console.log("\u4f59\u989d\u4e0d\u4e3a0\uff0c\u4e0d\u80fd\u4e0b\u5355",e.data);var n={"ret":0,"data":e.data,"post_url":c,"msg":"\u4f59\u989d\u4e0d\u4e3a0\uff0c\u4e0d\u80fd\u4e0b\u5355"};o(n)}}})},m.sendOrder=function(e,o,a){var n,t=wx.getStorageSync("login_rsp"),r=wx.getStorageSync("game_config").game_key,c=g+"miniGame/order",i=m.getPubData();n=f?"37":"54";var s={"role_level":e.role_level,"role_online_time":e.role_online_time,"role_name":e.role_name,"role_server":e.role_server,"role_id":e.role_id,"role_type":e.role_type,"role_gender":e.role_gender,"association_id":e.association_id,"association_name":e.association_name,"association_rank":e.association_rank},l={"access_token":t.access_token,"total_charge":e.total_charge,"currency_code":"RMB","async_callback_url":e.async_callback_url,"server_id":e.server_id,"out_trade_no":e.out_trade_no,"product_amount":e.product_amount,"product_desc":e.product_desc,"product_id":e.product_id,"product_name":e.product_name,"rate":e.rate,"role_id":e.role_id,"role_name":e.role_name,"pay_type":n,"agent_type":1,"platform_id":5};i.role=s,i.verify=l;var d=m.createSign(i)+r,_=u.md5(d);i.sign=_,wx.request({"url":c,"data":i,"method":"POST","header":{"content-type":"application/json"},"success":function(e){if("success"==e.data.msg){console.log("\u4e0b\u5355\u8bf7\u6c42\u6210\u529f:",e.data);var n=parseInt(l.total_charge)*parseInt(l.rate)/100;console.log("\u4e0b\u5355\u91d1\u989d\uff08\u5206\uff09:",n),a?m.changeMiniPay(e.data.content.order_sn):m.androidMiniPay(n,e.data,o)}else{console.log("\u4e0b\u5355\u8bf7\u6c42\u5931\u8d25:",e.data);var t={"ret":0,"data":e.data,"post_url":c,"msg":"\u4e0b\u5355\u8bf7\u6c42\u5931\u8d25"};o(t)}}})},m.mnBuy=function(t,o,a){wx.checkSession({"success":function(e){if("checkSession:ok"==e.errMsg){console.log("\u767b\u5f55\u6709\u6548",e),m.isChangePay(t,a)}else{console.log("\u767b\u5f55\u8fc7\u671f\u3002\u8bf7\u91cd\u65b0\u767b\u5f55",e);var n={"ret":0,"data":e.data,"msg":"\u767b\u5f55\u8fc7\u671f\u3002\u8bf7\u91cd\u65b0\u767b\u5f55"};a(n),o()}},"fail":function(){console.log("\u767b\u5f55\u8fc7\u671f\u3002\u8bf7\u91cd\u65b0\u767b\u5f55",res);var e={"ret":0,"data":res.data,"msg":"\u767b\u5f55\u8fc7\u671f\u3002\u8bf7\u91cd\u65b0\u767b\u5f55"};a(e),o()}})},m.isChangePay=function(n,t){var e=m.getPubData(),o=e.device,a=e.game,r=e.channel_platform,c=wx.getStorageSync("login_rsp"),i=wx.getStorageSync("game_config").game_id,s={"extra_data":{"screen_brightness":o.screen_brightness,"bluetooth":"","system_version":o.os_ver,"application_name":a.game_name,"mac":"","orientation_sensor":"","from":o.os_type,"inner_ip":"","package_name":o.package_name,"battery_level":o.battery_level,"device_id":"","application_version":a.game_ver,"imei":"","is_root":"","brand":o.brand,"screen_size":o.screen_width|o.screen_height,"sdk_version":o.sdk_ver,"device_name":o.device_name,"wifi_name":"","cpu_type":"","imsi":"","model":o.model},"order":{"access_token":c.access_token,"async_callback_url":n.async_callback_url,"currency_code":n.currency_code,"extend":{"game_channel_id":r.ad_id},"out_trade_no":n.out_trade_no,"product_amount":n.product_amount,"product_desc":n.product_desc,"product_id":n.product_id,"product_name":n.product_name,"rate":"10","role_id":n.role_id,"role_level":n.role_level,"role_name":n.role_name,"server_id":n.server_id,"total_charge":n.total_charge,"user_id":n.role_id,"user_online_time":n.role_online_time},"time":Math.round((new Date).getTime()/1e3),"union_app_id":i,"union_channel":r.ad_id};wx.request({"url":"https://payments.aidalan.com/v1/miniGame/ystaticSwitch","data":s,"method":"POST","header":{"content-type":"application/json"},"success":function(e){1==e.data.ret?""!=e.data.content.url?(console.log("\u5207\u652f\u4ed8"),m.sendOrder(n,t,!0)):(console.log("\u4e0d\u5207\u652f\u4ed8"),m.judgePay(n,t,!1)):(console.log(e),m.judgePay(n,t,!1))},"fail":function(e){console.log(e),m.judgePay(n,t,!1)}})},m.judgePay=function(e,n,t){f?m.getBalance(e,n,t):wx.showToast({"title":"\u6682\u672a\u5f00\u901a","icon":"none"})},m.changeMiniPay=function(n){console.log("\u5207\u652f\u4ed8\u8fdb\u5165\u5ba2\u670d"),wx.showModal({"title":"\u8ba2\u5355\u652f\u4ed8","content":"\u6211\u544a\u8bc9\u4f60\u5982\u4f55\u652f\u4ed8","showCancel":!1,"confirmText":"\u8fdb\u5165\u5ba2\u670d","success":function(e){e.confirm?(console.log("\u7528\u6237\u70b9\u51fb\u786e\u5b9a"),wx.openCustomerServiceConversation({"showMessageCard":!0,"sessionFrom":n,"sendMessageTitle":n,"success":function(e){console.log(e)},"fail":function(e){console.log(e)}})):e.cancel&&console.log("\u7528\u6237\u70b9\u51fb\u53d6\u6d88")}})},m.androidMiniPay=function(e,n,t){var o={"mode":"game","env":1,"offerId":wx.getStorageSync("game_config").offer_id,"currencyType":"CNY","buyQuantity":e,"platform":"android","zoneId":1,"success":function(e){console.log("\u652f\u4ed8\u6210\u529f",e),m.payCallback(n,t)},"fail":function(e){console.error("\u652f\u4ed8\u9519\u8bef: ",e);var n={"ret":0,"data":res.data,"msg":"\u7c73\u5927\u5e08\u652f\u4ed8\u9519\u8bef"};t(n)}};wx.requestMidasPayment(o)},m.payCallback=function(e,o){var n=wx.getStorageSync("game_config"),t=n.game_id,a=n.game_name,r=n.game_ver,c=n.game_key,i=new Date,s=e.content.union_notify_url,l={"union_app_id":t,"out_trade_no":e.content.order_sn,"open_id":wx.getStorageSync("open_id"),"time":""+Math.round(i.getTime()/1e3)},d={"game_name":a,"game_id":t,"game_ver":r,"pay_type":"37"},_=m.createSign(l)+c;_=_.replace(/\"/g,"");var g=u.md5(_);l.sign=g,l.extra_info=d,wx.request({"url":s,"data":l,"method":"POST","header":{"content-type":"application/json"},"success":function(e){if(console.log("payCallback:",e.data),1==e.data.ret){var n={"ret":1,"data":e.data,"msg":"\u652f\u4ed8\u6210\u529f"};o(n)}else{var t={"ret":0,"data":e.data,"post_url":s,"msg":"\u652f\u4ed8\u5931\u8d25"};o(t)}}})},m.listenClick=function(i){wx.onTouchEnd(function(e){function n(e,n){e.setDate(e.getDate()+n);var t=e.getFullYear(),o=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,a=e.getDate()<10?"0"+e.getDate():e.getDate();return Number(t+o+a)}if(n(new Date,0)<=n(new Date(i),15)){var t=e.changedTouches[0],o=t.clientX,a=t.clientY,r=m.getPubData(),c={"event":"mini_game","x":o,"y":a};r.verify=c,wx.request({"url":g+"miniGame/record","data":r,"method":"POST","header":{"content-type":"application/json"},"success":function(e){console.log(e),1==e.data.ret?console.log("\u76d1\u542c\u6210\u529f"):console.log("\u76d1\u542c\u5931\u8d25")}})}})},e.exports=m},function(e,n,t){"use strict";function i(e,n){return e<<n|e>>>32-n}function _(e,n){var t,o,a,r,c;return a=2147483648&e,r=2147483648&n,c=(1073741823&e)+(1073741823&n),(t=1073741824&e)&(o=1073741824&n)?2147483648^c^a^r:t|o?1073741824&c?3221225472^c^a^r:1073741824^c^a^r:c^a^r}function g(e,n,t,o,a,r,c){return e=_(e,_(_(n&t|~n&o,a),c)),_(i(e,r),n)}function u(e,n,t,o,a,r,c){return e=_(e,_(_(n&o|t&~o,a),c)),_(i(e,r),n)}function m(e,n,t,o,a,r,c){return e=_(e,_(_(n^t^o,a),c)),_(i(e,r),n)}function f(e,n,t,o,a,r,c){return e=_(e,_(_(t^(n|~o),a),c)),_(i(e,r),n)}function p(e){var n,t="",o="";for(n=0;n<=3;n++){t+=(o="0"+(e>>>8*n&255).toString(16)).substr(o.length-2,2)}return t}e.exports.md5=function(e){var n,t,o,a,r,c,i,s,l,d=Array();for(d=function(e){for(var n,t=e.length,o=t+8,a=16*(1+(o-o%64)/64),r=Array(a-1),c=0,i=0;i<t;){c=i%4*8,r[n=(i-i%4)/4]=r[n]|e.charCodeAt(i)<<c,i++}return c=i%4*8,r[n=(i-i%4)/4]=r[n]|128<<c,r[a-2]=t<<3,r[a-1]=t>>>29,r}(e=function(e){e=e.replace(/\x0d\x0a/g,"\n");for(var n="",t=0;t<e.length;t++){var o=e.charCodeAt(t);o<128?n+=String.fromCharCode(o):(127<o&&o<2048?n+=String.fromCharCode(o>>6|192):(n+=String.fromCharCode(o>>12|224),n+=String.fromCharCode(o>>6&63|128)),n+=String.fromCharCode(63&o|128))}return n}(e)),c=1732584193,i=4023233417,s=2562383102,l=271733878,n=0;n<d.length;n+=16){c=g(t=c,o=i,a=s,r=l,d[n+0],7,3614090360),l=g(l,c,i,s,d[n+1],12,3905402710),s=g(s,l,c,i,d[n+2],17,606105819),i=g(i,s,l,c,d[n+3],22,3250441966),c=g(c,i,s,l,d[n+4],7,4118548399),l=g(l,c,i,s,d[n+5],12,1200080426),s=g(s,l,c,i,d[n+6],17,2821735955),i=g(i,s,l,c,d[n+7],22,4249261313),c=g(c,i,s,l,d[n+8],7,1770035416),l=g(l,c,i,s,d[n+9],12,2336552879),s=g(s,l,c,i,d[n+10],17,4294925233),i=g(i,s,l,c,d[n+11],22,2304563134),c=g(c,i,s,l,d[n+12],7,1804603682),l=g(l,c,i,s,d[n+13],12,4254626195),s=g(s,l,c,i,d[n+14],17,2792965006),c=u(c,i=g(i,s,l,c,d[n+15],22,1236535329),s,l,d[n+1],5,4129170786),l=u(l,c,i,s,d[n+6],9,3225465664),s=u(s,l,c,i,d[n+11],14,643717713),i=u(i,s,l,c,d[n+0],20,3921069994),c=u(c,i,s,l,d[n+5],5,3593408605),l=u(l,c,i,s,d[n+10],9,38016083),s=u(s,l,c,i,d[n+15],14,3634488961),i=u(i,s,l,c,d[n+4],20,3889429448),c=u(c,i,s,l,d[n+9],5,568446438),l=u(l,c,i,s,d[n+14],9,3275163606),s=u(s,l,c,i,d[n+3],14,4107603335),i=u(i,s,l,c,d[n+8],20,1163531501),c=u(c,i,s,l,d[n+13],5,2850285829),l=u(l,c,i,s,d[n+2],9,4243563512),s=u(s,l,c,i,d[n+7],14,1735328473),c=m(c,i=u(i,s,l,c,d[n+12],20,2368359562),s,l,d[n+5],4,4294588738),l=m(l,c,i,s,d[n+8],11,2272392833),s=m(s,l,c,i,d[n+11],16,1839030562),i=m(i,s,l,c,d[n+14],23,4259657740),c=m(c,i,s,l,d[n+1],4,2763975236),l=m(l,c,i,s,d[n+4],11,1272893353),s=m(s,l,c,i,d[n+7],16,4139469664),i=m(i,s,l,c,d[n+10],23,3200236656),c=m(c,i,s,l,d[n+13],4,681279174),l=m(l,c,i,s,d[n+0],11,3936430074),s=m(s,l,c,i,d[n+3],16,3572445317),i=m(i,s,l,c,d[n+6],23,76029189),c=m(c,i,s,l,d[n+9],4,3654602809),l=m(l,c,i,s,d[n+12],11,3873151461),s=m(s,l,c,i,d[n+15],16,530742520),c=f(c,i=m(i,s,l,c,d[n+2],23,3299628645),s,l,d[n+0],6,4096336452),l=f(l,c,i,s,d[n+7],10,1126891415),s=f(s,l,c,i,d[n+14],15,2878612391),i=f(i,s,l,c,d[n+5],21,4237533241),c=f(c,i,s,l,d[n+12],6,1700485571),l=f(l,c,i,s,d[n+3],10,2399980690),s=f(s,l,c,i,d[n+10],15,4293915773),i=f(i,s,l,c,d[n+1],21,2240044497),c=f(c,i,s,l,d[n+8],6,1873313359),l=f(l,c,i,s,d[n+15],10,4264355552),s=f(s,l,c,i,d[n+6],15,2734768916),i=f(i,s,l,c,d[n+13],21,1309151649),c=f(c,i,s,l,d[n+4],6,4149444226),l=f(l,c,i,s,d[n+11],10,3174756917),s=f(s,l,c,i,d[n+2],15,718787259),i=f(i,s,l,c,d[n+9],21,3951481745),c=_(c,t),i=_(i,o),s=_(s,a),l=_(l,r)}return(p(c)+p(i)+p(s)+p(l)).toLowerCase()}}]);